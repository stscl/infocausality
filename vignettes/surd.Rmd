---
title: "Synergistic-Unique-Redundant Decomposition of Causality (SURD)"
date: |
  | Last update: 2025-10-10
  | Last run: `r Sys.Date()`
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{surd}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  message = FALSE,
  comment = "##",
  fig.path = "man/figures/surd/"
)
```

# Introduction

Understanding how causal influences combine and interact is essential for both temporal and spatial systems. The **Synergisticâ€“Uniqueâ€“Redundant Decomposition (SURD)** framework provides a principled way to break down total information flow between variables into:

* **Unique** contributions â€” information uniquely provided by one driver;
* **Redundant** contributions â€” information shared by multiple drivers;
* **Synergistic** contributions â€” information only revealed when drivers are considered together.

This vignette demonstrates how to perform SURD analysis using the `infocausality` package. We will explore both temporal and spatial cases, showing how `infocausality` unifies **time-series** and **spatial cross-sectional** causal analysis via consistent interfaces to `data.frame`, `sf`, and `SpatRaster` objects.

# Utility Functions

To simplify post-processing and visualization, two helper functions are provided below.

`utils_process_surd_result()` converts a `surd_list` object (as returned by an SURD computation routine) into a tidy `tibble` for plotting and further analysis.

```{r}
utils_process_surd_result = \(surd_list,threshold = 0){
  I_unique = surd_list$unique
  I_synergistic = surd_list$synergistic
  I_redundant = surd_list$redundant
  info_leak = surd_list$info_leak

  df = tibble::tibble(
    label = c(
      paste0("U[", names(I_unique), "]"),
      paste0("S[", names(I_synergistic), "]"),
      paste0("R[", names(I_redundant), "]")
    ),
    value = c(as.numeric(I_unique),
              as.numeric(I_synergistic),
              as.numeric(I_redundant)),
    type = c(rep("unique", length(I_unique)),
             rep("synergistic", length(I_synergistic)),
             rep("redundant", length(I_redundant)))
  )

  df$value = df$value / sum(df$value)
  if(threshold > 0){
    df = dplyr::filter(df, value > threshold)
  }
  return(df)
}
```

`utils_plot_surd()` produces a SURD decomposition plot â€” a grouped bar chart of **unique (U)**, **synergistic (S)**, and **redundant (R)** components, along with a side panel showing the **information leak**.

```{r}
utils_plot_surd = \(surd_list,threshold = 0){
  I_unique = surd_list$unique
  I_synergistic = surd_list$synergistic
  I_redundant = surd_list$redundant

  df = tibble::tibble(
    label = c(
      paste0("U[", names(I_unique), "]"),
      paste0("S[", names(I_synergistic), "]"),
      paste0("R[", names(I_redundant), "]")
    ),
    value = c(as.numeric(I_unique),
              as.numeric(I_synergistic),
              as.numeric(I_redundant)),
    type = c(rep("unique", length(I_unique)),
             rep("synergistic", length(I_synergistic)),
             rep("redundant", length(I_redundant)))
  )

  df$value = df$value / sum(df$value)
  if(threshold > 0){
    df = dplyr::filter(df, value > threshold)
  }
  df$label = factor(df$label, levels = df$label)

  colors = c(unique = "#d62828", synergistic = "#f77f00", redundant = "#003049")

  p1 = ggplot2::ggplot(df, ggplot2::aes(x = label, y = value, fill = type)) +
    ggplot2::geom_col(color = "black", linewidth = 0.15, show.legend = FALSE) +
    ggplot2::scale_fill_manual(name = NULL, values = colors) +
    ggplot2::scale_x_discrete(name = NULL, labels = function(x) parse(text = x)) +
    ggplot2::scale_y_continuous(name = NULL, limits = c(0, 1), expand = c(0, 0),
                                breaks = c(0, 0.25, 0.5, 0.75, 1),
                                labels = c("0", "0.25", "0.5", "0.75", "1") ) +
    ggplot2::theme_bw() +
    ggplot2::theme(
      axis.ticks.x = ggplot2::element_blank(),
      axis.text.x = ggplot2::element_text(angle = 45, hjust = 1),
      panel.grid = ggplot2::element_blank(),
      panel.border = ggplot2::element_rect(color = "black", linewidth = 2)
    )

  df_leak = tibble::tibble(label = "Info Leak", value = surd_list$info_leak)
  p2 = ggplot2::ggplot(df_leak, ggplot2::aes(x = label, y = value)) +
    ggplot2::geom_col(fill = "gray", color = "black", linewidth = 0.15) +
    ggplot2::scale_x_discrete(name = NULL, expand = c(0, 0)) +
    ggplot2::scale_y_continuous(name = NULL, limits = c(0, 1), expand = c(0, 0),
                                breaks = c(0,1), labels = c(0,1) ) +
    ggplot2::theme_bw() +
    ggplot2::theme(
      axis.ticks.x = ggplot2::element_blank(),
      panel.grid = ggplot2::element_blank(),
      panel.border = ggplot2::element_rect(color = "black", linewidth = 2)
    )

  patchwork::wrap_plots(p1, p2, ncol = 2, widths = c(10,1))
}
```

# Example Cases

The following sections demonstrate SURD decomposition in different contexts, illustrating its flexibility across temporal and spatial causal analyses.

## Case 1 â€” Temporal SURD Analysis (tEDM: CVDs)

* **Goal**: Analyze causal interactions among cardiovascular variables over time.
* **Input**: Multivariate time-series (e.g., heart rate, blood pressure, respiration).
* **Process**:

  * Compute information flow among variables;
  * Apply SURD decomposition;
  * Visualize results via `utils_plot_surd()`.

```{r eval = FALSE}
# Example pseudo-code
library(infocausality)

surd_cvd <- infocausality::causality_surd(data = cvd_ts, method = "tedm")
utils_plot_surd(surd_cvd)
```

## Case 2 â€” Spatial SURD Analysis (spEDM: Population Density)

* **Goal**: Discover causal relationships among spatial population density fields.
* **Input**: Raster stack or `SpatRaster` of population density across regions.
* **Process**:

  * Estimate spatial information flow between grids;
  * Decompose total information into Uâ€“Sâ€“R components.

```{r eval = FALSE}
pop_surd <- infocausality::causality_surd(popdensity_raster, method = "spedm")
utils_plot_surd(pop_surd)
```

## Case 3 â€” Spatial SURD Analysis (spEDM: NPP)

* **Goal**: Explore causal drivers of Net Primary Productivity (NPP) variations.
* **Input**: Raster stack of NPP and potential environmental covariates.
* **Process**:

  * Apply SURD to evaluate redundancy and synergy among climatic drivers;
  * Visualize decomposition structure.

```{r eval = FALSE}
npp_surd <- infocausality::causality_surd(npp_raster, method = "spedm")
utils_plot_surd(npp_surd)
```

ðŸ§© *See also*:

* `?infocausality::surd()` for function details.
* [`spEDM`](https://cran.r-project.org/package=spEDM) package for spatial empirical dynamic modeling.
* [`tEDM`](https://cran.r-project.org/package=tEDM) package for temporal empirical dynamic modeling.

